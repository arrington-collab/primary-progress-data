<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Los Art√≠culos de Fe - Kanban Board</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Quicksand', sans-serif; overflow: hidden; background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0f172a 100%); }
    .font-display { font-family: 'Cinzel', serif; }
    .scrollbar-thin::-webkit-scrollbar { width: 6px; height: 6px; }
    .scrollbar-thin::-webkit-scrollbar-track { background: rgba(30,41,59,0.5); border-radius: 3px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: rgba(59,130,246,0.5); border-radius: 3px; }
    .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: rgba(59,130,246,0.7); }
    .kanban-column { background: linear-gradient(180deg, rgba(30,41,59,0.8) 0%, rgba(15,23,42,0.9) 100%); }
    .child-card { background: linear-gradient(135deg, rgba(30,58,138,0.6) 0%, rgba(15,23,42,0.8) 100%); transition: all 0.3s ease; }
    .child-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59,130,246,0.3); }
    .tab-active { background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); color: white; }
    .tab-inactive { background: rgba(30,41,59,0.6); color: rgba(148,163,184,1); }
    .tab-inactive:hover { background: rgba(51,65,85,0.8); }
    .matrix-cell { transition: all 0.2s ease; }
    .matrix-cell:hover { transform: scale(1.1); }
    .stage-comenzando { border-left: 4px solid #ef4444; }
    .stage-progreso { border-left: 4px solid #f59e0b; }
    .stage-casi { border-left: 4px solid #3b82f6; }
    .stage-completado { border-left: 4px solid #22c55e; }
  </style>
</head>
<body class="min-h-screen text-white">
  <div class="h-screen flex flex-col p-6">
    <!-- Header -->
    <header class="text-center mb-4 flex-shrink-0">
      <div class="flex items-center justify-center gap-4 mb-2">
        <div class="h-px w-16 bg-gradient-to-r from-transparent to-yellow-400/50"></div>
        <svg class="w-5 h-5 text-yellow-400" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L14.4 8.6L21.5 9.5L16.5 14.5L17.8 21.5L12 18.2L6.2 21.5L7.5 14.5L2.5 9.5L9.6 8.6L12 2Z"/></svg>
        <div class="h-px w-16 bg-gradient-to-l from-transparent to-yellow-400/50"></div>
      </div>
      <h1 class="font-display text-4xl font-bold mb-1 bg-gradient-to-r from-yellow-300 via-yellow-400 to-amber-400 bg-clip-text text-transparent">
        Los Art√≠culos de Fe
      </h1>
      <p class="text-sm text-blue-200/60 tracking-widest uppercase">Barrio Pueblo</p>
      
      <!-- Stats Row -->
      <div class="flex justify-center gap-8 mt-3">
        <div class="text-center">
          <span id="stat-completed" class="text-2xl font-bold text-yellow-400">0</span>
          <span class="text-xs text-blue-300/60 ml-1">Completados</span>
        </div>
        <div class="text-center">
          <span id="stat-children" class="text-2xl font-bold text-blue-400">0</span>
          <span class="text-xs text-blue-300/60 ml-1">Ni√±os</span>
        </div>
        <div class="text-center">
          <span id="stat-articles" class="text-2xl font-bold text-cyan-400">0</span>
          <span class="text-xs text-blue-300/60 ml-1">Art√≠culos</span>
        </div>
      </div>
    </header>

    <!-- Tab Buttons -->
    <div class="flex justify-center gap-2 mb-4">
      <button id="tab-stages" onclick="switchView('stages')" class="px-6 py-2 rounded-lg font-semibold text-sm transition-all tab-active">
        üìä Por Etapa de Progreso
      </button>
      <button id="tab-articles" onclick="switchView('articles')" class="px-6 py-2 rounded-lg font-semibold text-sm transition-all tab-inactive">
        üìã Por Art√≠culo
      </button>
      <button id="tab-matrix" onclick="switchView('matrix')" class="px-6 py-2 rounded-lg font-semibold text-sm transition-all tab-inactive">
        üìà Vista Matriz
      </button>
    </div>

    <!-- View Container -->
    <div id="view-container" class="flex-1 overflow-hidden">
      <!-- Views will be rendered here -->
    </div>

    <!-- Footer -->
    <footer class="text-center pt-3 flex-shrink-0 border-t border-blue-500/20 mt-2">
      <span id="last-updated" class="text-xs text-blue-300/40">Cargando...</span>
    </footer>
  </div>

  <!-- Loading -->
  <div id="loading" class="fixed inset-0 bg-slate-950 flex items-center justify-center z-50">
    <div class="text-center">
      <div class="text-5xl mb-3 animate-bounce">‚≠ê</div>
      <div class="text-xl text-blue-300/50">Cargando...</div>
    </div>
  </div>

  <script>
    const DATA_URL = './data/primary-progress.json';
    const REFRESH_INTERVAL = 30000;
    let currentView = 'stages';
    let childrenData = [];

    const STAGES = [
      { id: 'comenzando', name: 'Comenzando', range: [0, 3], color: 'red', emoji: 'üå±' },
      { id: 'progreso', name: 'En Progreso', range: [4, 7], color: 'amber', emoji: 'üìö' },
      { id: 'casi', name: 'Casi Listo', range: [8, 12], color: 'blue', emoji: 'üåü' },
      { id: 'completado', name: '¬°Completado!', range: [13, 13], color: 'green', emoji: 'üèÜ' }
    ];

    function getStage(progreso) {
      return STAGES.find(s => progreso >= s.range[0] && progreso <= s.range[1]) || STAGES[0];
    }

    function createChildCard(child, showProgress = true) {
      const stage = getStage(child.progreso);
      const isComplete = child.progreso === 13;
      return `
        <div class="child-card rounded-xl p-3 border border-blue-500/20 stage-${stage.id}">
          <div class="flex items-center justify-between mb-2">
            <span class="font-semibold text-white">${child.nombre}</span>
            ${isComplete ? '<span class="text-yellow-400">‚≠ê</span>' : ''}
          </div>
          ${showProgress ? `
            <div class="flex items-center gap-2">
              <div class="flex-1 h-2 bg-slate-700/50 rounded-full overflow-hidden">
                <div class="h-full rounded-full bg-gradient-to-r ${isComplete ? 'from-yellow-500 to-amber-400' : 'from-blue-600 to-cyan-400'}" style="width: ${(child.progreso/13)*100}%"></div>
              </div>
              <span class="text-xs font-bold ${isComplete ? 'text-yellow-400' : 'text-blue-300'}">${child.progreso}/13</span>
            </div>
          ` : ''}
        </div>
      `;
    }

    function renderStagesView() {
      const columns = STAGES.map(stage => {
        const stageChildren = childrenData.filter(c => {
          const s = getStage(c.progreso);
          return s.id === stage.id;
        });
        
        return `
          <div class="kanban-column rounded-xl p-4 min-w-[280px] flex flex-col h-full">
            <div class="flex items-center gap-2 mb-4 pb-3 border-b border-slate-600/50">
              <span class="text-2xl">${stage.emoji}</span>
              <div>
                <h3 class="font-bold text-white">${stage.name}</h3>
                <span class="text-xs text-slate-400">${stage.range[0]}-${stage.range[1]} art√≠culos</span>
              </div>
              <span class="ml-auto bg-slate-700/80 text-white text-sm font-bold px-2 py-1 rounded-full">${stageChildren.length}</span>
            </div>
            <div class="flex-1 overflow-y-auto scrollbar-thin space-y-3">
              ${stageChildren.length > 0 
                ? stageChildren.map(c => createChildCard(c)).join('') 
                : '<div class="text-center text-slate-500 py-8 text-sm">Sin ni√±os</div>'
              }
            </div>
          </div>
        `;
      }).join('');

      return `<div class="flex gap-4 h-full overflow-x-auto scrollbar-thin pb-2">${columns}</div>`;
    }

    function renderArticlesView() {
      const columns = [];
      for (let i = 1; i <= 13; i++) {
        const completedChildren = childrenData.filter(c => c.articulosCompletados.includes(i));
        const pendingChildren = childrenData.filter(c => !c.articulosCompletados.includes(i));
        
        columns.push(`
          <div class="kanban-column rounded-xl p-3 min-w-[200px] flex flex-col h-full">
            <div class="text-center mb-3 pb-2 border-b border-slate-600/50">
              <div class="w-10 h-10 mx-auto mb-1 rounded-full bg-gradient-to-br from-yellow-400 to-amber-500 flex items-center justify-center text-slate-900 font-bold text-lg">${i}</div>
              <span class="text-xs text-slate-400">Art√≠culo ${i}</span>
              <div class="flex justify-center gap-2 mt-1">
                <span class="text-xs text-green-400">‚úì ${completedChildren.length}</span>
                <span class="text-xs text-slate-500">‚óã ${pendingChildren.length}</span>
              </div>
            </div>
            <div class="flex-1 overflow-y-auto scrollbar-thin space-y-2">
              ${completedChildren.map(c => `
                <div class="bg-green-900/30 border border-green-500/30 rounded-lg px-3 py-2 text-sm">
                  <span class="text-green-300">‚úì</span> ${c.nombre}
                </div>
              `).join('')}
              ${pendingChildren.map(c => `
                <div class="bg-slate-800/30 border border-slate-600/30 rounded-lg px-3 py-2 text-sm text-slate-400">
                  ‚óã ${c.nombre}
                </div>
              `).join('')}
            </div>
          </div>
        `);
      }

      return `<div class="flex gap-3 h-full overflow-x-auto scrollbar-thin pb-2">${columns.join('')}</div>`;
    }

    function renderMatrixView() {
      const headerCells = ['<th class="p-2 text-left font-semibold text-blue-300 sticky left-0 bg-slate-900/95 z-10 min-w-[150px]">Nombre</th>'];
      for (let i = 1; i <= 13; i++) {
        headerCells.push(`<th class="p-2 text-center font-bold text-yellow-400 min-w-[50px]">${i}</th>`);
      }
      headerCells.push('<th class="p-2 text-center font-semibold text-cyan-400 min-w-[80px]">Total</th>');

      const rows = childrenData.map(child => {
        const cells = [`<td class="p-2 font-semibold text-white sticky left-0 bg-slate-900/95 z-10">${child.nombre}</td>`];
        for (let i = 1; i <= 13; i++) {
          const completed = child.articulosCompletados.includes(i);
          cells.push(`
            <td class="p-2 text-center">
              <div class="matrix-cell w-8 h-8 mx-auto rounded-full flex items-center justify-center ${completed ? 'bg-gradient-to-br from-green-400 to-emerald-500 text-white' : 'bg-slate-700/50 text-slate-500'}">
                ${completed ? '‚úì' : ''}
              </div>
            </td>
          `);
        }
        const isComplete = child.progreso === 13;
        cells.push(`<td class="p-2 text-center font-bold ${isComplete ? 'text-yellow-400' : 'text-blue-300'}">${child.progreso}/13 ${isComplete ? '‚≠ê' : ''}</td>`);
        return `<tr class="border-b border-slate-700/50 hover:bg-slate-800/30">${cells.join('')}</tr>`;
      }).join('');

      return `
        <div class="h-full overflow-auto scrollbar-thin rounded-xl bg-slate-900/50">
          <table class="w-full border-collapse">
            <thead class="sticky top-0 bg-slate-900/95 z-20">
              <tr class="border-b border-slate-600">${headerCells.join('')}</tr>
            </thead>
            <tbody>${rows}</tbody>
          </table>
        </div>
      `;
    }

    function switchView(view) {
      currentView = view;
      
      // Update tab styles
      document.querySelectorAll('[id^="tab-"]').forEach(tab => {
        tab.classList.remove('tab-active');
        tab.classList.add('tab-inactive');
      });
      document.getElementById('tab-' + view).classList.remove('tab-inactive');
      document.getElementById('tab-' + view).classList.add('tab-active');
      
      renderCurrentView();
    }

    function renderCurrentView() {
      const container = document.getElementById('view-container');
      switch(currentView) {
        case 'stages': container.innerHTML = renderStagesView(); break;
        case 'articles': container.innerHTML = renderArticlesView(); break;
        case 'matrix': container.innerHTML = renderMatrixView(); break;
      }
    }

    function formatDate(dateString) {
      return new Date(dateString).toLocaleDateString('es-ES', {
        weekday: 'long', day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit'
      });
    }

    async function fetchData() {
      try {
        const response = await fetch(DATA_URL + '?t=' + Date.now());
        if (!response.ok) throw new Error('Failed to fetch');
        const data = await response.json();
        
        childrenData = data.children;
        
        // Update stats
        document.getElementById('stat-completed').textContent = data.children.filter(c => c.progreso === 13).length;
        document.getElementById('stat-children').textContent = data.children.length;
        document.getElementById('stat-articles').textContent = data.children.reduce((sum, c) => sum + c.progreso, 0);
        document.getElementById('last-updated').textContent = '√öltima actualizaci√≥n: ' + formatDate(data.lastUpdated);
        
        renderCurrentView();
        document.getElementById('loading').style.display = 'none';
      } catch (error) {
        console.error('Error:', error);
      }
    }

    fetchData();
    setInterval(fetchData, REFRESH_INTERVAL);
  </script>
</body>
</html>
