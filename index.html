<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mis Artículos de Fe - Primary Progress Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/framer-motion@11.0.8/dist/framer-motion.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'display': ['Cinzel', 'serif'],
            'body': ['Quicksand', 'sans-serif'],
          },
        }
      }
    }
  </script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Quicksand', sans-serif; overflow: hidden; }
    .font-display { font-family: 'Cinzel', serif; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;
    const { motion, AnimatePresence } = window["framer-motion"];

    // ============================================
    // CONFIGURATION
    // ============================================
    const CONFIG = {
      // Relative path since we're on the same domain
      dataUrl: './data/primary-progress.json',
      refreshInterval: 30000,
      scrollSpeed: 0.5,
    };

    // Sparkle component
    const Sparkle = ({ delay = 0 }) => (
      <motion.div
        className="absolute w-2 h-2 bg-yellow-300 rounded-full"
        initial={{ opacity: 0, scale: 0 }}
        animate={{
          opacity: [0, 1, 0],
          scale: [0, 1.5, 0],
          x: Math.random() * 60 - 30,
          y: Math.random() * 60 - 30,
        }}
        transition={{ duration: 1, delay, ease: "easeOut" }}
        style={{
          left: `${Math.random() * 100}%`,
          top: `${Math.random() * 100}%`,
          boxShadow: '0 0 10px 2px rgba(255, 215, 0, 0.8)',
        }}
      />
    );

    // Star component
    const Star = ({ size = 20, className = "", style = {} }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" className={className} style={style}>
        <path fill="currentColor" d="M12 2L14.4 8.6L21.5 9.5L16.5 14.5L17.8 21.5L12 18.2L6.2 21.5L7.5 14.5L2.5 9.5L9.6 8.6L12 2Z" />
      </svg>
    );

    // Progress Card Component
    const ProgressCard = ({ child, isAnimating }) => {
      const progressPercent = (child.progreso / 13) * 100;
      const isComplete = child.progreso === 13;

      return (
        <motion.div layout initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="relative">
          <motion.div
            className={`relative overflow-hidden rounded-2xl p-5 bg-gradient-to-br from-slate-900/90 via-blue-950/80 to-slate-900/90 border-2 backdrop-blur-sm ${isComplete ? 'border-yellow-400/60' : 'border-blue-400/30'}`}
            style={{
              boxShadow: isComplete ? '0 0 30px rgba(250,204,21,0.3)' : '0 0 20px rgba(59,130,246,0.2)'
            }}
            animate={isAnimating ? {
              scale: [1, 1.05, 1],
              boxShadow: ['0 0 20px rgba(59,130,246,0.2)', '0 0 50px rgba(250,204,21,0.8)', '0 0 20px rgba(59,130,246,0.2)']
            } : {}}
            transition={{ duration: 0.8 }}
          >
            {isAnimating && (
              <div className="absolute inset-0 pointer-events-none">
                {[...Array(12)].map((_, i) => <Sparkle key={i} delay={i * 0.08} />)}
              </div>
            )}

            {isComplete && (
              <motion.div className="absolute -top-1 -right-1" initial={{ rotate: -20, scale: 0 }} animate={{ rotate: 0, scale: 1 }} transition={{ type: "spring", stiffness: 200 }}>
                <Star size={32} className="text-yellow-400" style={{ filter: 'drop-shadow(0 0 8px rgba(250,204,21,0.8))' }} />
              </motion.div>
            )}

            <div className="absolute inset-0 bg-gradient-to-t from-blue-600/10 to-transparent pointer-events-none" />

            <h3 className="font-display text-xl font-bold text-white mb-3 tracking-wide">{child.nombre}</h3>

            <div className="relative h-4 bg-slate-800/80 rounded-full overflow-hidden mb-4 border border-blue-500/20">
              <motion.div
                className={`h-full rounded-full ${isComplete ? 'bg-gradient-to-r from-yellow-500 via-yellow-400 to-amber-300' : 'bg-gradient-to-r from-blue-600 via-blue-500 to-cyan-400'}`}
                initial={{ width: 0 }}
                animate={{ width: `${progressPercent}%` }}
                transition={{ duration: 1, ease: "easeOut" }}
              />
              <div className="absolute inset-0 bg-gradient-to-b from-white/20 to-transparent pointer-events-none" />
            </div>

            <div className="flex justify-between items-center mb-4">
              <span className="text-blue-200/80 text-sm font-medium">Progreso</span>
              <span className={`font-bold text-lg ${isComplete ? 'text-yellow-400' : 'text-blue-300'}`}>
                {child.progreso} / 13
              </span>
            </div>

            <div className="flex flex-wrap gap-1.5 justify-center">
              {[...Array(13)].map((_, index) => {
                const articleNum = index + 1;
                const isCompleted = child.articulosCompletados.includes(articleNum);
                return (
                  <motion.div
                    key={articleNum}
                    className={`relative w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold transition-all duration-300 ${isCompleted ? 'bg-gradient-to-br from-yellow-400 to-amber-500 text-slate-900' : 'bg-slate-700/60 text-slate-500 border border-slate-600/50'}`}
                    style={isCompleted ? { boxShadow: '0 0 12px rgba(250,204,21,0.5)' } : {}}
                  >
                    {articleNum}
                    {isCompleted && <div className="absolute inset-0 rounded-full bg-gradient-to-t from-transparent to-white/30 pointer-events-none" />}
                  </motion.div>
                );
              })}
            </div>
          </motion.div>
        </motion.div>
      );
    };

    // Floating stars background
    const FloatingStars = () => {
      const [stars, setStars] = useState([]);
      
      useEffect(() => {
        setStars([...Array(20)].map((_, i) => ({
          id: i,
          x: Math.random() * 100,
          y: Math.random() * 100,
          size: 8 + Math.random() * 16,
          opacity: 0.1 + Math.random() * 0.3
        })));
      }, []);

      return (
        <div className="fixed inset-0 pointer-events-none overflow-hidden">
          {stars.map(star => (
            <motion.div
              key={star.id}
              className="absolute"
              style={{ left: `${star.x}%`, top: `${star.y}%` }}
              animate={{ y: [0, -20, 0], opacity: [star.opacity, star.opacity * 1.5, star.opacity] }}
              transition={{ duration: 10 + Math.random() * 10, repeat: Infinity, ease: "linear" }}
            >
              <Star size={star.size} className="text-yellow-400/30" />
            </motion.div>
          ))}
        </div>
      );
    };

    // Connection status indicator
    const ConnectionStatus = ({ isConnected, isLoading }) => (
      <div className="absolute top-4 right-4 flex items-center gap-2">
        {isLoading && (
          <div className="w-3 h-3 rounded-full bg-blue-400 animate-pulse" />
        )}
        {!isLoading && (
          <div className={`w-3 h-3 rounded-full ${isConnected ? 'bg-green-400' : 'bg-yellow-400'}`} />
        )}
        <span className="text-xs text-blue-300/50">
          {isLoading ? 'Actualizando...' : (isConnected ? 'Conectado' : 'Esperando datos...')}
        </span>
      </div>
    );

    // Main App
    function App() {
      const [children, setChildren] = useState([]);
      const [animatingIds, setAnimatingIds] = useState(new Set());
      const [lastUpdated, setLastUpdated] = useState(new Date());
      const [isConnected, setIsConnected] = useState(false);
      const [isLoading, setIsLoading] = useState(true);
      const scrollContainerRef = useRef(null);
      const [autoScroll, setAutoScroll] = useState(true);
      const previousDataRef = useRef({});

      const fetchData = useCallback(async () => {
        setIsLoading(true);
        try {
          const response = await fetch(CONFIG.dataUrl + '?t=' + Date.now(), {
            cache: 'no-store',
            headers: { 'Accept': 'application/json' }
          });
          
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          
          const data = await response.json();
          
          const newAnimatingIds = new Set();
          data.children.forEach(child => {
            const prevChild = previousDataRef.current[child.id];
            if (prevChild && child.progreso > prevChild.progreso) {
              newAnimatingIds.add(child.id);
            }
          });
          
          if (newAnimatingIds.size > 0) {
            setAnimatingIds(newAnimatingIds);
            setTimeout(() => setAnimatingIds(new Set()), 1500);
          }
          
          previousDataRef.current = {};
          data.children.forEach(c => previousDataRef.current[c.id] = c);
          
          setChildren(data.children);
          setLastUpdated(new Date(data.lastUpdated));
          setIsConnected(true);
        } catch (error) {
          console.error('Error fetching data:', error);
          if (children.length === 0) {
            setIsConnected(false);
          }
        } finally {
          setIsLoading(false);
        }
      }, [children.length]);

      useEffect(() => {
        fetchData();
        const interval = setInterval(fetchData, CONFIG.refreshInterval);
        return () => clearInterval(interval);
      }, [fetchData]);

      useEffect(() => {
        if (!autoScroll || !scrollContainerRef.current) return;
        const container = scrollContainerRef.current;
        const scrollHeight = container.scrollHeight - container.clientHeight;
        if (scrollHeight <= 0) return;

        let scrollDirection = 1;
        let currentScroll = 0;
        
        const scrollInterval = setInterval(() => {
          currentScroll += scrollDirection * CONFIG.scrollSpeed;
          if (currentScroll >= scrollHeight) { scrollDirection = -1; currentScroll = scrollHeight; }
          else if (currentScroll <= 0) { scrollDirection = 1; currentScroll = 0; }
          container.scrollTop = currentScroll;
        }, 50);

        return () => clearInterval(scrollInterval);
      }, [autoScroll, children]);

      const formatDate = (date) => {
        return date.toLocaleDateString('es-ES', {
          weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'
        });
      };

      const completedCount = children.filter(c => c.progreso === 13).length;
      const totalArticles = children.reduce((sum, c) => sum + c.progreso, 0);

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-900 text-white overflow-hidden">
          <FloatingStars />
          <div className="fixed inset-0 bg-[radial-gradient(ellipse_at_top,rgba(59,130,246,0.15),transparent_50%)] pointer-events-none" />
          <div className="fixed inset-0 bg-[radial-gradient(ellipse_at_bottom_right,rgba(250,204,21,0.1),transparent_50%)] pointer-events-none" />

          <ConnectionStatus isConnected={isConnected} isLoading={isLoading} />

          <div className="relative z-10 h-screen flex flex-col p-8">
            <motion.header className="text-center mb-8 flex-shrink-0" initial={{ opacity: 0, y: -30 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.8 }}>
              <div className="flex items-center justify-center gap-4 mb-4">
                <div className="h-px w-24 bg-gradient-to-r from-transparent via-yellow-400/50 to-yellow-400" />
                <Star size={24} className="text-yellow-400" />
                <div className="h-px w-24 bg-gradient-to-l from-transparent via-yellow-400/50 to-yellow-400" />
              </div>

              <h1 className="font-display text-6xl font-bold mb-3 tracking-tight">
                <span className="bg-gradient-to-r from-yellow-300 via-yellow-400 to-amber-400 bg-clip-text text-transparent" style={{ filter: 'drop-shadow(0 0 30px rgba(250,204,21,0.4))' }}>
                  Mis Artículos de Fe
                </span>
              </h1>
              
              <p className="text-xl text-blue-200/80 font-light tracking-widest uppercase">Ward Primary Progress</p>

              <div className="flex justify-center gap-12 mt-6">
                <div className="text-center">
                  <div className="text-3xl font-bold text-yellow-400">{completedCount}</div>
                  <div className="text-sm text-blue-300/60 uppercase tracking-wider">Completados</div>
                </div>
                <div className="text-center">
                  <div className="text-3xl font-bold text-blue-400">{children.length}</div>
                  <div className="text-sm text-blue-300/60 uppercase tracking-wider">Niños</div>
                </div>
                <div className="text-center">
                  <div className="text-3xl font-bold text-cyan-400">{totalArticles}</div>
                  <div className="text-sm text-blue-300/60 uppercase tracking-wider">Artículos Memorizados</div>
                </div>
              </div>

              <div className="flex items-center justify-center gap-4 mt-6">
                <div className="h-px flex-1 max-w-xs bg-gradient-to-r from-transparent to-blue-500/30" />
                <div className="w-2 h-2 rounded-full bg-blue-400/50" />
                <div className="h-px flex-1 max-w-xs bg-gradient-to-l from-transparent to-blue-500/30" />
              </div>
            </motion.header>

            <div ref={scrollContainerRef} className="flex-1 overflow-y-auto scrollbar-hide" onMouseEnter={() => setAutoScroll(false)} onMouseLeave={() => setAutoScroll(true)}>
              {children.length === 0 ? (
                <div className="flex items-center justify-center h-full">
                  <div className="text-center text-blue-300/50">
                    <motion.div 
                      className="text-6xl mb-4"
                      animate={{ rotate: [0, 10, -10, 0] }}
                      transition={{ duration: 2, repeat: Infinity }}
                    >
                      ⭐
                    </motion.div>
                    <div className="text-2xl mb-2">Cargando datos...</div>
                    <div className="text-sm">Conectando con Google Sheets</div>
                  </div>
                </div>
              ) : (
                <motion.div className="grid grid-cols-4 gap-5 pb-8" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 0.5, delay: 0.3 }}>
                  <AnimatePresence>
                    {children.map((child, index) => (
                      <motion.div key={child.id} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: index * 0.03 }}>
                        <ProgressCard child={child} isAnimating={animatingIds.has(child.id)} />
                      </motion.div>
                    ))}
                  </AnimatePresence>
                </motion.div>
              )}
            </div>

            <motion.footer className="text-center pt-4 flex-shrink-0 border-t border-blue-500/20" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 1 }}>
              <div className="flex items-center justify-center gap-2 text-blue-300/50">
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span className="text-sm">Última actualización: {formatDate(lastUpdated)}</span>
              </div>
            </motion.footer>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
